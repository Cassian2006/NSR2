# NSR2 Agent Operating Rules


## Fixed Principles

1. Before every GitHub push/submit, run a review and `pytest` at least once.
2. GitHub repository: `https://github.com/Cassian2006/NSR2.git`.
3. Keep this `agent.md` updated with every operation, each with a timestamp.
4. After successfully implementing a meaningful part, do review + Git commit.
5. Prefer more tests and robustness checks.
6. `readme.md` is the project strategy/structure source of truth and may be questioned, updated, and improved during development.

## Commit Gate Checklist

- [ ] Code/path changes reviewed
- [ ] `pytest` executed and result recorded
- [ ] Key behavior manually verified when needed
- [ ] Operation log appended in this file

## Operation Log

- 2026-02-09T20:08:06+00:00 | Initialized `agent.md` rules and process.
- 2026-02-09T20:08:06+00:00 | Captured workspace snapshot (`backend`, `frontend`, `data`, `outputs`, `readme.md` present).
- 2026-02-09T20:08:22+00:00 | Initialized git repository in `NSR2`.
- 2026-02-09T20:08:22+00:00 | Added remote `origin` -> `https://github.com/Cassian2006/NSR2.git`.
- 2026-02-09T20:10:27+00:00 | Added backend smoke tests in `backend/tests/test_api_smoke.py`.
- 2026-02-09T20:10:27+00:00 | Pre-submit review: `python -m compileall app` (pass), `npm run build` in `frontend` (pass).
- 2026-02-09T20:10:27+00:00 | Pre-submit test: `python -m pytest -q` in `backend` -> `5 passed`.
- 2026-02-09T20:11:02+00:00 | Staged initial project files for first commit (excluding `data/`).
- 2026-02-09T20:11:35+00:00 | Configured local git identity: `user.name=Cassian2006`, `user.email=Cassian2006@users.noreply.github.com`.
- 2026-02-09T20:11:35+00:00 | Created commit `03e9505` with backend/frontend skeleton and tests.
- 2026-02-09T20:11:35+00:00 | Pushed `main` to `origin` (`https://github.com/Cassian2006/NSR2.git`).
- 2026-02-09T20:11:51+00:00 | Pre-submit test before log commit: `python -m pytest -q` in `backend` -> `5 passed`.
- 2026-02-09T20:21:40+00:00 | Updated `.gitignore` to ignore all local dataset files under `data/**` while keeping `data/README.md` and `data/.gitkeep`.
- 2026-02-09T20:21:40+00:00 | Removed external legacy heatmap dependency in backend; `ais_heatmap` layer now resolves from local `data/ais_heatmap`.
- 2026-02-09T20:21:40+00:00 | Added local AIS heatmap generator: `backend/scripts/generate_ais_heatmap.py` + preprocessing module + tests.
- 2026-02-09T20:21:40+00:00 | Validation: `python -m compileall app scripts` (pass), `python -m pytest -q` (9 passed).
- 2026-02-09T20:21:40+00:00 | Runtime check: generated month heatmaps with `--month 202407 --step-hours 24 --tag smoke24h` -> 31 files.
- 2026-02-09T20:22:20+00:00 | Final pre-commit validation rerun: `python -m compileall app scripts` (pass), `python -m pytest -q` (9 passed).
- 2026-02-09T20:22:53+00:00 | Committed `4c4d9af`: ignore local data + add local AIS heatmap generator and tests.
- 2026-02-09T20:22:53+00:00 | Pushed `4c4d9af` to `origin/main`.
- 2026-02-09T20:23:11+00:00 | Pre-submit test before log sync commit: `python -m pytest -q` in `backend` -> `9 passed`.
- 2026-02-09T20:42:19+00:00 | Added QA scripts: `backend/scripts/visualize_heatmap.py` and `backend/scripts/audit_data_resources.py`.
- 2026-02-09T20:42:19+00:00 | Fixed AIS heatmap generation robustness: sort events by `postime` before rolling-window accumulation.
- 2026-02-09T20:42:19+00:00 | Re-generated local heatmaps: `7d` for `202407-202410`, and refreshed QA previews/reports under `outputs/qa`.
- 2026-02-09T20:42:19+00:00 | Validation: `python -m compileall app scripts` (pass), `python -m pytest -q` -> `10 passed`.
- 2026-02-09T20:42:47+00:00 | Committed and pushed `53617d4`: heatmap QA scripts + unsorted AIS generation fix.
- 2026-02-09T20:56:27+00:00 | Root-cause check: source env vars (ice_conc/ice_thick/wave_hs) in NSRcorridorNA only cover to 2024-10-31_00; 2024-10-31_06/12/18 absent at source intersection.
- 2026-02-09T20:56:27+00:00 | Built patch env tag NSRcorridorNA/data/interim/env_grids/202410_patch_fill and filled 2024-10-31_06/12/18 by persistence copy from 2024-10-31_00 (documented in env_build_report patch_note).
- 2026-02-09T20:56:27+00:00 | Ran src/data/align_windows.py with NSR_OUT_TAG=202410_patch_fill, NSR_WINDOW_HOURS=6; generated aligned windows including 2024-10-31_06/12/18.
- 2026-02-09T20:56:27+00:00 | Ran src/data/rasterize_corridor.py with NSR_DILATE=1, NSR_SIGMA=1.0, NSR_SKELETON=0, NSR_DISTANCE=1, NSR_PROX=1; generated y_corridor/y_distance/y_prox for patch tag.
- 2026-02-09T20:56:27+00:00 | Copied patched sample dirs 2024-10-31_06, 2024-10-31_12, 2024-10-31_18 into NSR2/data/processed/samples/202410.
- 2026-02-09T20:56:27+00:00 | Verification: samples_202410 missing count -> 0/124; generated QA visualization outputs/qa/heatmap_oct31_18_compare.png and reran backend/scripts/audit_data_resources.py.
- 2026-02-09T20:57:05+00:00 | Pre-submit validation: python -m pytest -q in backend -> 10 passed.
- 2026-02-09T20:57:36+00:00 | Committed d45d523: docs: log Oct-31 sample backfill and validation.
- 2026-02-09T20:57:36+00:00 | Pushed d45d523 to origin/main.
- 2026-02-09T20:57:48+00:00 | Pre-submit validation before log-sync push: python -m pytest -q in backend -> 10 passed.
- 2026-02-09T21:18:51+00:00 | Generated NSR2 env grids from raw nc via NSRcorridorNA make_env_grids.py; patched missing 2024-10-31_06/12/18 by persistence copy from 2024-10-31_00; env total=492.
- 2026-02-09T21:18:51+00:00 | Added U-Net data prep module: backend/app/preprocess/unet_dataset.py (stacking, blocked mask, label merge, quicklook helpers).
- 2026-02-09T21:18:51+00:00 | Added scripts: backend/scripts/prepare_unet_annotation_pack.py and backend/scripts/build_unet_labels.py.
- 2026-02-09T21:18:51+00:00 | Built full annotation pack (202407-202410): data/processed/annotation_pack (492 samples).
- 2026-02-09T21:18:51+00:00 | Built training manifest: data/processed/unet_manifest.csv (train=368, val=124 with val_month=202410).
- 2026-02-09T21:18:51+00:00 | Added tests: backend/tests/test_unet_dataset_prep.py; validation: python -m pytest -q -> 14 passed.
- 2026-02-09T21:19:26+00:00 | Pre-submit validation before push: python -m pytest -q in backend -> 14 passed.
- 2026-02-09T21:19:26+00:00 | Committed 4b860b7: feat: prepare unet annotation pack and label manifest.
- 2026-02-09T21:19:26+00:00 | Pushed 4b860b7 to origin/main.
- 2026-02-09T21:19:39+00:00 | Pre-submit validation before log-sync push: python -m pytest -q in backend -> 14 passed.
- 2026-02-09T21:44:33+00:00 | Confirmed Labelme available: labelme --version -> 5.11.2; launched Labelme on annotation sample quicklook with label preset caution.
- 2026-02-09T21:44:33+00:00 | Added labelme conversion helper: backend/app/preprocess/labelme_io.py and backend/scripts/import_labelme_caution.py.
- 2026-02-09T21:44:33+00:00 | Added tests for labelme conversion: backend/tests/test_labelme_io.py; validation: python -m pytest -q -> 16 passed.
- 2026-02-09T21:45:12+00:00 | Pre-submit validation before push: python -m pytest -q in backend -> 16 passed.
- 2026-02-09T21:45:12+00:00 | Committed c06b6a5: feat: add labelme-to-caution import pipeline.
- 2026-02-09T21:45:12+00:00 | Pushed c06b6a5 to origin/main.
- 2026-02-09T21:45:22+00:00 | Pre-submit validation before log-sync push: python -m pytest -q in backend -> 16 passed.
- 2026-02-09T21:46:46+00:00 | Clarified labeling policy (blocked from bathy/land, caution manual, else safe) and generated balanced shortlist: data/processed/annotation_pack/SHORTLIST_50.txt (50 timestamps).
- 2026-02-09T21:54:42+00:00 | Verified LabelImg and Labelme binaries; launched LabelImg for annotation_pack directory test (bbox workflow).
- 2026-02-09T21:54:42+00:00 | Generated blocked-mask overlay previews for shortlist-50: quicklook_blocked_overlay.png in each timestamp folder.
- 2026-02-09T21:54:42+00:00 | Launched Labelme on overlay image (2024-10-31_18) with label preset caution for polygon-based caution annotation.
- 2026-02-09T21:57:47+00:00 | Created dedicated Labelme set: data/processed/annotation_pack/labelme_blocked_50 with 50 renamed blocked-overlay images (blocked_001.png ... blocked_050.png).
- 2026-02-09T21:57:47+00:00 | Generated mapping file for renamed images: data/processed/annotation_pack/labelme_blocked_50/mapping.csv (filename -> timestamp).
- 2026-02-09T21:57:47+00:00 | Launched Labelme on labelme_blocked_50 folder with preset label caution.
- 2026-02-09T22:01:15+00:00 | Generated and opened land/ocean black-white map: outputs/qa/land_ocean_bw.png (black=land, white=ocean) from data/interim/env_grids/2024-10-31_18/x_bathy.npy.
- 2026-02-09T22:04:13+00:00 | Generated enhanced land-masked label set: data/processed/annotation_pack/labelme_blocked_50_enhanced (50 images + riskhint refs), and launched Labelme on this folder.
- 2026-02-09T22:22:24+00:00 | Ran annotation QC on labelme_blocked_50_enhanced JSONs: outputs/qa/annotation_overlap_report.csv (12 labeled files, overlap mean=0.0139, max=0.0749, no high-overlap cases).
- 2026-02-09T22:32:18+00:00 | Restarted Labelme and reopened annotation folder data/processed/annotation_pack/labelme_blocked_50_enhanced with label preset caution.
- 2026-02-09T22:46:13+00:00 | Added script backend/scripts/import_labelme_from_mapping.py to map renamed Labelme JSONs (blocked_XXX_riskhint.json) back to timestamp caution masks via mapping.csv.
- 2026-02-09T22:46:13+00:00 | Imported current annotations from labelme_blocked_50_enhanced: converted=32 JSONs into data/processed/annotation_pack/<timestamp>/caution_mask.(png|npy).
- 2026-02-09T22:46:13+00:00 | Built labeled-only manifest: data/processed/unet_manifest_labeled.csv with --skip-empty-caution (rows=19; train=13 val=6, val_month=202409).
- 2026-02-09T22:46:13+00:00 | Added quick baseline trainer backend/scripts/train_unet_quick.py (patch-based TinyUNet, weighted CE, train/val summary + checkpoints).
- 2026-02-09T22:46:13+00:00 | Fixed NaN instability in trainer by sanitizing non-finite inputs before stats/normalization.
- 2026-02-09T22:46:13+00:00 | Baseline run complete: outputs/train_runs/unet_quick_20260209_224525/summary.json (best epoch=7, val_loss=0.5703, val_miou=0.5713, val_iou_caution=0.0923, val_iou_blocked=0.8563).
- 2026-02-09T22:46:13+00:00 | Validation: python -m pytest -q -> 16 passed.
- 2026-02-09T22:46:41+00:00 | Pre-submit validation before push: python -m pytest -q in backend -> 16 passed.
- 2026-02-09T22:46:41+00:00 | Committed 24e8dcf: feat: import labelme mapping and run quick unet baseline.
- 2026-02-09T22:46:41+00:00 | Pushed 24e8dcf to origin/main.
- 2026-02-09T22:46:54+00:00 | Pre-submit validation before log-sync push: python -m pytest -q in backend -> 16 passed.
- 2026-02-09T22:50:01+00:00 | Verified current labelme JSON quality: 32 *_riskhint.json all contain positive caution polygons (label=caution).
- 2026-02-09T22:50:01+00:00 | Rebuilt labeled manifest from annotation_pack with --skip-empty-caution; result updated to rows=32 (train=26, val=6).
- 2026-02-09T22:50:01+00:00 | Reran quick baseline with 32 labeled samples: outputs/train_runs/unet_quick_20260209_224924/summary.json (best val_loss=0.5048, val_miou=0.6021, val_iou_caution=0.2399, val_iou_blocked=0.8748).
- 2026-02-09T22:58:20+00:00 | Added reusable TinyUNet module: backend/app/model/tiny_unet.py and test backend/tests/test_tiny_unet.py.
- 2026-02-09T22:58:20+00:00 | Upgraded trainer backend/scripts/train_unet_quick.py with stronger augmentation options (rot90/gamma/noise) and caution-focused patch sampling.
- 2026-02-09T22:58:20+00:00 | Added active learning script backend/scripts/active_learning_suggest.py; ranked 460 unlabeled candidates and exported top-20 set at outputs/active_learning/active_20260209_225559/labelme_active_topk.
- 2026-02-09T22:58:20+00:00 | Updated import script backend/scripts/import_labelme_from_mapping.py to support configurable filename template for different label rounds.
- 2026-02-09T22:58:20+00:00 | Training comparison runs completed: unet_quick_20260209_225653 and unet_quick_20260209_225723 (augmentation configs tested).
- 2026-02-09T22:58:20+00:00 | Validation: python -m pytest -q -> 17 passed.
- 2026-02-09T22:58:47+00:00 | Pre-submit validation before push: python -m pytest -q in backend -> 17 passed.
- 2026-02-09T22:58:47+00:00 | Committed 2692c35: feat: add active learning suggestion flow and stronger quick training aug.
- 2026-02-09T22:58:47+00:00 | Pushed 2692c35 to origin/main.
- 2026-02-09T22:59:04+00:00 | Pre-submit validation before log-sync push: python -m pytest -q in backend -> 17 passed.
- 2026-02-09T23:10:07+00:00 | Generated review overlays for active top-20 at outputs/active_learning/active_20260209_225559/labelme_active_topk/review_overlay20 (blocked=black, AI suggest=cyan+white edge), with mapping_review.csv.
- 2026-02-09T23:21:01+00:00 | Added backend/scripts/finalize_active_review.py to finalize active-review labels by merging human review JSON with AI suggested caution masks.
- 2026-02-09T23:21:01+00:00 | Finalized active top-20 review into annotation_pack: merged=19, suggest_only=1.
- 2026-02-09T23:21:01+00:00 | Rebuilt labeled manifest: data/processed/unet_manifest_labeled.csv -> rows=52 (train=39, val=13 with val_month=202408).
- 2026-02-09T23:21:01+00:00 | Retrained quick U-Net on 52 labels: outputs/train_runs/unet_quick_20260209_231959/summary.json (best val_loss=0.2922, val_miou=0.6743, val_iou_caution=0.3012, val_iou_blocked=0.9394; best caution epoch=4 -> 0.3290).
- 2026-02-09T23:21:01+00:00 | Validation: python -m pytest -q -> 17 passed.
- 2026-02-09T23:21:23+00:00 | Pre-submit validation before push: python -m pytest -q in backend -> 17 passed.
- 2026-02-09T23:21:23+00:00 | Committed bef9055: feat: finalize active review labels and retrain on 52 samples.
- 2026-02-09T23:21:23+00:00 | Pushed bef9055 to origin/main.
- 2026-02-09T23:27:35+00:00 | Started new active-learning round: generated active_20260209_232624 top-20 and review overlays at outputs/active_learning/active_20260209_232624/labelme_active_topk/review_overlay20; restarted Labelme on review folder.
- 2026-02-10T12:13:32+00:00 | Finalized active round active_20260209_232624 review labels into annotation_pack: merged=11, suggest_only=9.
- 2026-02-10T12:13:32+00:00 | Rebuilt labeled manifest after round merge: data/processed/unet_manifest_labeled.csv -> rows=72 (train=57, val=15, val_month=202408).
- 2026-02-10T12:13:32+00:00 | Retrained quick U-Net on 72 labels: outputs/train_runs/unet_quick_20260210_121250/summary.json (best val_loss=0.3840, val_miou=0.6461, val_iou_caution=0.3801, val_iou_blocked=0.8822).
- 2026-02-10T12:26:50+00:00 | Started next active-learning round: active_20260210_122544 (top-20), generated review overlays at outputs/active_learning/active_20260210_122544/labelme_active_topk/review_overlay20, and restarted Labelme on this folder.
- 2026-02-10T13:08:08+00:00 | Finalized active round active_20260210_122544 review labels into annotation_pack: merged=15, suggest_only=5.
- 2026-02-10T13:08:08+00:00 | Rebuilt labeled manifest after merge: data/processed/unet_manifest_labeled.csv -> rows=92 (train=71, val=21, val_month=202408).
- 2026-02-10T13:08:08+00:00 | Retrained quick U-Net on 92 labels: outputs/train_runs/unet_quick_20260210_130711/summary.json (best val_loss=0.3167, val_miou=0.7220, val_iou_caution=0.4313, val_iou_blocked=0.9325; peak caution epoch=9 -> 0.4637).
- 2026-02-10T13:11:33+00:00 | Started new active-learning round: active_20260210_131016 (top-20), generated review overlays at outputs/active_learning/active_20260210_131016/labelme_active_topk/review_overlay20, and restarted Labelme on review folder.
- 2026-02-10T13:16:27+00:00 | Finalized active round active_20260210_131016 review labels into annotation_pack: merged=9, suggest_only=11.
- 2026-02-10T13:16:27+00:00 | Rebuilt labeled manifest after merge: data/processed/unet_manifest_labeled.csv -> rows=112 (train=80, val=32, val_month=202408).
- 2026-02-10T13:16:27+00:00 | Retrained quick U-Net on 112 labels: outputs/train_runs/unet_quick_20260210_131527/summary.json (best val_loss=0.3352, val_miou=0.6629, val_iou_caution=0.4300, val_iou_blocked=0.8681; peak caution epoch=3 -> 0.4816).
- 2026-02-10T13:27:46.9066241Z | Tuned backend/scripts/active_learning_suggest.py for conservative AI suggestion defaults: pred_threshold=0.60, max_suggest_ratio=0.06, plus neighborhood smoothing controls.
- 2026-02-10T13:27:46.9066241Z | Added tests backend/tests/test_active_learning_suggest.py covering ratio-capped thresholding and binary mask smoothing behavior.
- 2026-02-10T13:27:46.9066241Z | Validation: python -m pytest -q in backend -> 19 passed.
- 2026-02-10T13:27:46.9066241Z | Ran strict active-learning export: python backend/scripts/active_learning_suggest.py --top-k 20 --pred-threshold 0.65 --max-suggest-ratio 0.04 --smooth-min-neighbors 2 --smooth-iters 1 -> outputs/active_learning/active_20260210_132408/labelme_active_topk.
- 2026-02-10T13:27:46.9066241Z | QA on top-20 suggested masks: mean sea ratio=0.0466 (min=0.0455, max=0.0480), confirming lower AI auto-annotation coverage for manual²¹±ê workflow.
- 2026-02-10T13:30:26.0264903Z | Prepared isolated labeling folder for current active round: outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_raw (20 raw images + mapping.csv + README.txt).
- 2026-02-10T13:30:26.0264903Z | Launched Labelme and Explorer on outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_raw for manual caution²¹±ê workflow.
- 2026-02-10T13:32:11.0224680Z | Fixed black active-learning base images: backend/scripts/active_learning_suggest.py now loads quicklook_blocked_overlay.png, then quicklook.png, then quicklook_riskhint.png before zero fallback.
- 2026-02-10T13:32:11.0224680Z | Repaired current batch visuals in-place for outputs/active_learning/active_20260210_132408/labelme_active_topk and only20_raw by regenerating active_001..020 from annotation_pack quicklook images.
- 2026-02-10T13:32:11.0224680Z | Validation: python -m pytest -q in backend -> 19 passed. Relaunched Labelme on outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_raw.
- 2026-02-10T13:38:25.4139201Z | Generated overlay labeling set with landmask+AI suggestion: outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_landmask_ai (blocked/land=black, AI caution=cyan with white boundary).
- 2026-02-10T13:38:25.4139201Z | Launched Explorer and Labelme on outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_landmask_ai for manual²¹±ê.
- 2026-02-10T14:40:01.6346997Z | Finalized user-completed active round from outputs/active_learning/active_20260210_132408/labelme_active_topk/only20_landmask_ai: merged=20, human_only=0, suggest_only=0.
- 2026-02-10T14:40:01.6346997Z | Rebuilt labeled manifest: data/processed/unet_manifest_labeled.csv -> rows=132 (train=90, val=42, val_month=202408, skip-empty-caution=true).
- 2026-02-10T14:40:01.6346997Z | Trained quick U-Net baseline (default 4 epochs): outputs/train_runs/unet_quick_20260210_143810/summary.json.
- 2026-02-10T14:40:01.6346997Z | Trained extended quick U-Net (12 epochs): outputs/train_runs/unet_quick_20260210_143847/summary.json (best loss epoch=10, val_loss=0.3896; peak caution epoch=11, val_iou_caution=0.3683).
- 2026-02-10T14:40:16.2746577Z | Validation: python -m pytest -q in backend -> 19 passed.
- 2026-02-10T14:53:33.0373774Z | Added backend/scripts/filter_hard_samples.py to score label difficulty (CE + caution IoU) and export filtered manifest by dropping top-K hard train samples.
- 2026-02-10T14:53:33.0373774Z | Ran hard-sample audit using outputs/train_runs/unet_quick_20260210_131527/best.pt: exported data/processed/unet_manifest_filtered_hard10.csv and report data/processed/unet_manifest_filtered_hard10.report.json (dropped 10 train rows, 0 val rows).
- 2026-02-10T14:53:33.0373774Z | Ran augmentation+cycle training experiments: unet_cycle_full_v1, unet_cycle_filtered_v1, unet_cycle_filtered_v2, unet_cycle_full_v2, unet_cycle_full_v3 for comparison.
- 2026-02-10T14:53:33.0373774Z | Best balanced run so far from this sweep: outputs/train_runs/unet_cycle_full_v1/summary.json (best val_loss=0.2587, val_miou=0.7058, val_iou_caution=0.4198, val_iou_blocked=0.9206).
- 2026-02-10T14:53:33.0373774Z | Validation: python -m pytest -q in backend -> 19 passed.
- 2026-02-10T15:00:57.8603599Z | Started new optimization labeling round from outputs/train_runs/unet_cycle_full_v1/summary.json using active_learning_suggest (top_k=20, pred_threshold=0.68, max_suggest_ratio=0.035, smooth=2x1).
- 2026-02-10T15:00:57.8603599Z | Generated round outputs at outputs/active_learning/active_20260210_145951/labelme_active_topk with suggest ratio mean=0.0411 (min=0.0392, max=0.0432).
- 2026-02-10T15:00:57.8603599Z | Prepared labeling folders: only20_raw and only20_landmask_ai (blocked=black, AI suggestion=cyan+white edge), and launched Labelme on only20_landmask_ai.
- 2026-02-10T15:10:30.9966684Z | Received user completion notice for active round active_20260210_145951; detected 15/20 review JSONs in only20_landmask_ai.
- 2026-02-10T15:10:30.9966684Z | Finalized partial review merge for active_20260210_145951 with --merge-with-suggest: merged=15, suggest_only=5, human_only=0.
- 2026-02-10T15:10:30.9966684Z | Rebuilt manifest after merge: data/processed/unet_manifest_labeled.csv -> rows=152 (train=109, val=43, val_month=202408).
- 2026-02-10T15:10:30.9966684Z | Trained run outputs/train_runs/unet_cycle_full_v1_r2 and outputs/train_runs/unet_cycle_full_v1_r2_focus for post-merge evaluation.
- 2026-02-10T15:14:17.5201507Z | User selected option 2: prepared missing-5 rapid review set for active_20260210_145951 at labelme_active_topk/review_missing5_landmask_ai and review_missing5_raw, with mapping_missing5.csv.
- 2026-02-10T15:14:17.5201507Z | Missing ranks/timestamps: 8(2024-07-22_06), 11(2024-07-20_12), 17(2024-07-22_00), 19(2024-07-25_12), 20(2024-07-30_06). Launched Labelme on review_missing5_landmask_ai.
- 2026-02-10T15:23:09.8742288Z | Received user completion for missing-5 review; copied newly provided review JSONs into active_20260210_145951/only20_landmask_ai (4 new: active_008/017/019/020).
- 2026-02-10T15:23:09.8742288Z | Re-finalized active_20260210_145951 with full mapping: merged=19, suggest_only=1 (remaining missing review: active_011 / 2024-07-20_12).
- 2026-02-10T15:23:09.8742288Z | Rebuilt manifest post-merge: data/processed/unet_manifest_labeled.csv -> rows=152 (train=109, val=43).
- 2026-02-10T15:23:09.8742288Z | Retrain comparison runs completed: outputs/train_runs/unet_cycle_full_v1_r3 and outputs/train_runs/unet_cycle_full_v1_r3_focus; both underperform prior bests (v1 and v1_r2_focus).
- 2026-02-10T15:32:00.1755556Z | Integrated real U-Net inference backend path: /v1/infer now runs TinyUNet using configured best summary/ckpt, normalizes x_stack, caches outputs to outputs/pred/{model_version}/{timestamp}.npy, and returns class histogram/ratios.
- 2026-02-10T15:32:00.1755556Z | Updated dataset timestamp source to prefer annotation_pack and fallback to legacy samples only when annotation_pack unavailable, aligning /v1/timestamps with infer-ready data.
- 2026-02-10T15:32:00.1755556Z | Added inference runtime regression test backend/tests/test_model_infer_runtime.py (persist + cache-hit behavior).
- 2026-02-10T15:32:00.1755556Z | Validation: python -m pytest -q in backend -> 20 passed.
- 2026-02-10T15:35:47.3796775Z | Upgraded /v1/route/plan from straight-line stub to grid-based constrained planner (A*): blocked = bathy OR unet_blocked, start/goal snapping to nearest navigable cell, optional smoothing, and explain metrics (distance/caution_len/corridor_alignment).
- 2026-02-10T15:35:47.3796775Z | routes_plan now normalizes timestamp, validates planning errors as HTTP 422, and writes gallery metadata from constrained plan outputs.
- 2026-02-10T15:35:47.3796775Z | Validation: python -m pytest -q in backend -> 20 passed.
- 2026-02-10T15:54:15.2016266Z | Frontend integration started for next phase: wired infer endpoint and interactive route workflow in MapWorkspace with API-backed availability refresh.
- 2026-02-10T15:54:15.2016266Z | Added frontend API client infer call (runInference) and InferResponse types in frontend/src/api/client.ts.
- 2026-02-10T15:54:15.2016266Z | Updated frontend/src/pages/MapWorkspace.tsx with Run U-Net Inference button, inference stats panel, map click pick mode for start/goal, and improved route/inference toasts.
- 2026-02-10T15:54:15.2016266Z | Validation: npm run build in frontend succeeded; python -m pytest -q in backend -> 20 passed.
- 2026-02-10T15:58:27.3085873Z | Continued M4 Gallery implementation: reviewed pending diffs in frontend/src/api/client.ts and frontend/src/pages/ExportReport.tsx for API-backed gallery list/detail/download/delete flow.
- 2026-02-10T15:58:27.3085873Z | Validation: npm run build in frontend succeeded after Gallery integration updates.
- 2026-02-10T15:58:27.3085873Z | Validation: python -m pytest -q in backend -> 20 passed (1 warning: torch.load future weights_only default).
- 2026-02-10T16:06:30.7059513Z | Enhanced Gallery image generation: backend/app/core/gallery.py now creates a non-placeholder route preview PNG from route_geojson/start/goal using in-memory RGB rendering and PNG encoding (fallback to placeholder on exception).
- 2026-02-10T16:06:30.7059513Z | Extended API smoke coverage: backend/tests/test_api_smoke.py now validates /v1/gallery/{id}/image.png returns image/png with non-trivial size (>500 bytes).
- 2026-02-10T16:06:30.7059513Z | Frontend workflow integration: MapWorkspace adds Open In Gallery action after successful plan; top navigation Export button now routes to /export.
- 2026-02-10T16:06:30.7059513Z | Validation: npm run build (frontend) succeeded; python -m pytest -q (backend) -> 20 passed, 1 warning.
- 2026-02-10T16:16:41.7045858Z | Implemented real layer rendering backend: added backend/app/core/render.py with bbox/size parsing, tile bbox conversion, grid sampling, continuous/class colormaps, and RGBA PNG encoding for bathy/ais/unet/ice/wave/wind overlays.
- 2026-02-10T16:16:41.7045858Z | Replaced placeholder layer endpoints in backend/app/api/routes_layers.py: /v1/overlay and /v1/tiles now render data-driven PNGs with timestamp normalization and request validation.
- 2026-02-10T16:16:41.7045858Z | Added API smoke coverage for rendered imagery in backend/tests/test_api_smoke.py (overlay and tile return image/png with non-trivial payload).
- 2026-02-10T16:16:41.7045858Z | Migrated frontend map to real Leaflet integration in frontend/src/components/MapCanvas.tsx with OSM base map, backend overlay image layers, route polyline, start/goal markers, and map click coordinates.
- 2026-02-10T16:16:41.7045858Z | Updated frontend/src/pages/MapWorkspace.tsx to pass timestamp into MapCanvas for dynamic layer rendering.
- 2026-02-10T16:16:41.7045858Z | Validation: python -m pytest -q (backend) -> 21 passed, 1 warning; npm run build (frontend) succeeded after adding leaflet/react-leaflet@4.2.1.
- 2026-02-10T16:19:47.2580727Z | Planning policy refinement: backend/app/planning/router.py now supports caution modes tie_breaker/budget/minimize/strict as effective cost policies; strict blocks unet caution cells via blocked_sources or caution_mode=strict.
- 2026-02-10T16:19:47.2580727Z | Added explainability fields in route output: effective_caution_penalty, effective_corridor_reward, and grid_bounds for traceability.
- 2026-02-10T16:19:47.2580727Z | Grid coordinate bounds made configurable in backend/app/core/config.py (grid_lat_min/max, grid_lon_min/max) and wired into planning/overlay mapping.
- 2026-02-10T16:19:47.2580727Z | Updated frontend/src/pages/MapWorkspace.tsx strict policy mapping to send blocked_sources=[bathy,unet_blocked,unet_caution] and caution_mode=strict.
- 2026-02-10T16:19:47.2580727Z | Extended backend/tests/test_api_smoke.py with route mode coverage (caution_mode=minimize) and verified effective penalty output.
- 2026-02-10T16:19:47.2580727Z | Validation: python -m pytest -q (backend) -> 22 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:22:48.8920172Z | Added gallery image upload endpoint POST /v1/gallery/{id}/image in backend/app/api/routes_gallery.py with base64 decoding + payload validation.
- 2026-02-10T16:22:48.8920172Z | Extended backend/app/core/gallery.py with set_image_bytes(gallery_id, bytes) to replace preview image when frontend screenshot is available.
- 2026-02-10T16:22:48.8920172Z | Extended backend/tests/test_api_smoke.py to verify gallery image upload path updates /v1/gallery/{id}/image.png content.
- 2026-02-10T16:22:48.8920172Z | Added frontend API method uploadGalleryImage in frontend/src/api/client.ts and wired MapWorkspace automatic screenshot upload after successful route planning.
- 2026-02-10T16:22:48.8920172Z | Integrated html2canvas dependency for front-end map capture; map pane is captured and uploaded as PNG data URL, with graceful fallback to backend preview on failure.
- 2026-02-10T16:22:48.8920172Z | Validation: python -m pytest -q (backend) -> 22 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:25:13.7229874Z | Added AIS evaluation module backend/app/eval/compare_ais.py to score route-vs-heatmap quality (top10/top25 hit rates, normalized alignment, z-score, in-grid ratio).
- 2026-02-10T16:25:13.7229874Z | Added backend API endpoint POST /v1/eval/ais/backtest in backend/app/api/routes_eval.py; supports gallery_id shortcut or explicit timestamp+route_geojson payload.
- 2026-02-10T16:25:13.7229874Z | Registered eval router in backend/app/main.py and extended smoke tests with test_eval_ais_backtest in backend/tests/test_api_smoke.py.
- 2026-02-10T16:25:13.7229874Z | Extended frontend Export page with Run Backtest action and AIS metrics cards; wired runAisBacktest in frontend/src/api/client.ts.
- 2026-02-10T16:25:13.7229874Z | Validation: python -m pytest -q (backend) -> 23 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:27:09.7965176Z | Rewrote readme.md in clean UTF-8 and synchronized it with current implementation state (React+Vite+FastAPI stack, real overlay/tile rendering, planning modes, gallery screenshot upload, AIS backtest API).
- 2026-02-10T16:27:09.7965176Z | Validation before push: python -m pytest -q (backend) -> 23 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:31:05.6419781Z | Added backend/app/core/geo.py introducing GridGeo + load_grid_geo: supports optional per-timestamp lat/lon axis files (latitudes/lats/lat + longitudes/lons/lon) with fallback to configured grid bounds.
- 2026-02-10T16:31:05.6419781Z | Integrated geo mapping into backend/app/planning/router.py: lat/lon <-> grid conversion now uses GridGeo; explain.grid_bounds now reflects effective geo bounds.
- 2026-02-10T16:31:05.6419781Z | Integrated geo mapping into backend/app/core/render.py and backend/app/eval/compare_ais.py so overlay sampling and AIS backtest use the same coordinate mapping logic as planner.
- 2026-02-10T16:31:05.6419781Z | Added unit coverage in backend/tests/test_geo_mapping.py for axis roundtrip, annotation-axis preference, and fallback bound behavior.
- 2026-02-10T16:31:05.6419781Z | Validation: python -m pytest -q (backend) -> 26 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:32:32.3868028Z | Upgraded route smoothing in backend/app/planning/router.py from direction-compression to obstacle-aware line-of-sight simplification using Bresenham visibility checks (_line_of_sight + _smooth_cells_los).
- 2026-02-10T16:32:32.3868028Z | Added smoothing unit tests in backend/tests/test_router_smoothing.py covering obstacle intersection, aggressive simplification without obstacles, and turn preservation when shortcuts are blocked.
- 2026-02-10T16:32:32.3868028Z | Validation: python -m pytest -q (backend) -> 29 passed, 1 warning; npm run build (frontend) succeeded.
- 2026-02-10T16:38:18.6794975Z | Frontend bundle optimization: enabled route-level lazy loading in frontend/src/routes.ts and RouterProvider fallback in frontend/src/App.tsx.
- 2026-02-10T16:38:18.6794975Z | Moved html2canvas to dynamic import in frontend/src/pages/MapWorkspace.tsx so capture logic is loaded on demand after planning.
- 2026-02-10T16:38:18.6794975Z | Added manual chunk strategy in frontend/vite.config.ts to split map-vendor, capture-vendor, router-vendor, ui-vendor, and generic vendor bundles.
- 2026-02-10T16:38:18.6794975Z | Validation: npm run build (frontend) succeeded with split chunks (largest single chunk reduced from previous monolith); python -m pytest -q (backend) -> 29 passed, 1 warning.
- 2026-02-10T16:46:21.3082417Z | Standardized frontend API error handling in frontend/src/api/client.ts: added ApiError, JSON/detail parsing, throwApiError helper, and getErrorMessage utility used by UI toasts.
- 2026-02-10T16:46:21.3082417Z | Replaced mixed i18n setup by rewriting frontend/src/contexts/LanguageContext.tsx with clean EN/ZH dictionaries for currently used keys, removing prior garbled zh text and react-i18next mismatch.
- 2026-02-10T16:46:21.3082417Z | Updated frontend map/gallery pages and components to consume translated keys and normalized error messages (MapWorkspace, ExportReport, CoordinateInput, MapCanvas).
- 2026-02-10T16:46:21.3082417Z | Validation: npm run build (frontend) succeeded with split chunks; python -m pytest -q (backend) -> 29 passed, 1 warning.
- 2026-02-10T16:49:36.9083172Z | Added backend/app/core/errors.py with global JSON error handlers for HTTP, validation, and unhandled exceptions (stable payload: code/status/message/detail).
- 2026-02-10T16:49:36.9083172Z | Wired install_error_handlers(app) in backend/app/main.py so all API routes emit standardized error responses.
- 2026-02-10T16:49:36.9083172Z | Extended backend/tests/test_api_smoke.py with test_error_payload_shape to guard 422 payload contract.
- 2026-02-10T16:52:14.5875271Z | Added test_route_plan_is_stable_and_stays_out_of_blocked in backend/tests/test_api_smoke.py to enforce deterministic planning outputs for identical inputs and assert all routed points stay outside fused blocked mask (bathy OR unet_blocked).
- 2026-02-10T16:52:14.5875271Z | Validation: python -m pytest -q (backend) -> 31 passed, 1 warning.
- 2026-02-10T16:53:12.2692579Z | Hardened model checkpoint loading in backend/app/model/infer.py: added _load_checkpoint() to prefer torch.load(..., weights_only=True) with backward-compatible fallback for older torch versions.
- 2026-02-10T16:53:12.2692579Z | Validation: python -m pytest -q (backend) -> 31 passed, 0 warnings.
- 2026-02-10T17:02:57.5745463Z | Started isolated runtime pair for manual UI testing due occupied default ports: backend on http://127.0.0.1:8001 (uvicorn) and frontend on http://127.0.0.1:5178 (vite).
- 2026-02-10T17:02:57.5745463Z | Added local dev override frontend/.env.local with VITE_API_BASE_URL=http://127.0.0.1:8001/v1 to ensure frontend requests reach NSR backend instance.
- 2026-02-10T17:03:07.8685136Z | Started isolated runtime pair for manual UI testing due occupied default ports: backend on http://127.0.0.1:8001 and frontend on http://127.0.0.1:5178.
- 2026-02-10T17:03:07.8685136Z | Added local dev override frontend/.env.local with VITE_API_BASE_URL=http://127.0.0.1:8001/v1.
- 2026-02-10T17:03:07.8685136Z | Runtime checks passed: backend /healthz responded OK and frontend at 127.0.0.1:5178 serves Arctic Sea Route Planner UI.
- 2026-02-10T17:35:55.3960624Z | Fixed local runtime CORS mismatch causing map overlay requests to be blocked from non-5173 frontend ports: expanded default cors_origins and added cors_origin_regex in backend/app/core/config.py; wired allow_origin_regex in backend/app/main.py.
- 2026-02-10T17:35:55.3960624Z | Added backend CORS regression test test_cors_allows_local_dev_origin in backend/tests/test_api_smoke.py (Origin 127.0.0.1:5178 receives access-control-allow-origin echo).
- 2026-02-10T17:35:55.3960624Z | Fixed workspace sidebar scroll behavior by adding min-h-0/overflow constraints to pane containers and ScrollArea roots in frontend/src/pages/MapWorkspace.tsx.
- 2026-02-10T17:35:55.3960624Z | Validation: backend pytest 32 passed; frontend build succeeded; runtime verification: /v1/datasets and /v1/overlay now return CORS headers for Origin http://127.0.0.1:5178.
- 2026-02-10T17:43:52.8381445Z | Reworked frontend map overlay rendering in frontend/src/components/MapCanvas.tsx from viewport ImageOverlay mode to georeferenced XYZ tile layers (/v1/tiles/{layer}/{z}/{x}/{y}.png), with per-layer panes/z-index and timestamp cache key, to improve basemap alignment and zoom behavior.
- 2026-02-10T17:43:52.8381445Z | Replaced workspace side-panel ScrollArea usage with native overflow containers in frontend/src/pages/MapWorkspace.tsx to guarantee vertical scrolling to the planning controls and route button.
- 2026-02-10T17:43:52.8381445Z | Validation: npm run build (frontend) succeeded; python -m pytest -q (backend) -> 32 passed.
- 2026-02-10T17:47:45.4762048Z | Fixed tile-projection alignment drift: added Web-Mercator pixel-to-lat/lon sampling for XYZ tiles in backend/app/core/render.py (render_tile_png + _tile_pixel_latlon_axes + axis-based sampler).
- 2026-02-10T17:47:45.4762048Z | Updated backend/app/api/routes_layers.py /v1/tiles endpoint to use render_tile_png instead of viewport-style overlay rendering.
- 2026-02-10T17:47:45.4762048Z | Updated frontend/src/pages/MapWorkspace.tsx so planned route markers use actual route endpoints and warning toast is shown when planner snaps start/goal to nearest navigable cell.
- 2026-02-10T17:47:45.4762048Z | Validation: backend pytest 32 passed; frontend build succeeded.
- 2026-02-10T17:54:17.0488794Z | Geo mapping fix for overlay alignment: backend/app/core/geo.py now loads grid axes from annotation meta target_lat/target_lon (or aoi_lat/aoi_lon), then falls back to data/interim/env_grids/<timestamp>/meta.json before configured bounds.
- 2026-02-10T17:54:17.0488794Z | Added env_grids_root to backend/app/core/config.py and wired geo-cache key to include env_grids_root for deterministic lookup.
- 2026-02-10T17:54:17.0488794Z | Updated frontend defaults to in-domain coordinates and view window for current dataset AOI in frontend/src/pages/MapWorkspace.tsx and frontend/src/components/MapCanvas.tsx.
- 2026-02-10T17:54:17.0488794Z | Updated backend tests to use in-domain route test coordinates; isolated geo fallback test by setting env_grids_root to tmp path in backend/tests/test_geo_mapping.py.
- 2026-02-10T17:54:17.0488794Z | Validation: backend pytest 32 passed; frontend build succeeded; runtime tile probe confirms west tile transparent and east tile non-empty after backend restart.
- 2026-02-10T18:03:18.2050884+00:00 | Audited blocked/caution labeling consistency across data/processed/annotation_pack (492 timestamps): y_class integrity check passed, blocked ratio static at ~59.86%, caution overlap with blocked low (mean ~0.26%, max ~7.49%).
- 2026-02-10T18:03:18.2050884+00:00 | Fixed UNet overlay interpretation in backend/app/core/render.py: when rendering layer `unet_pred`, hide caution/blocked pixels on bathy-blocked cells so red represents incremental UNet-blocked areas instead of re-coloring static bathy land mask.
- 2026-02-10T18:03:18.2050884+00:00 | Added backend/tests/test_render_unet_overlay.py to validate class colors and bathy-masked UNet rendering behavior.
- 2026-02-10T18:03:18.2050884+00:00 | Validation: python -m pytest -q (backend) -> 34 passed.
- 2026-02-10T18:04:38.5979151+00:00 | Exported per-timestamp blocked/caution audit report to outputs/qa/blocked_caution_audit.json (492 samples; includes class ratios and caution-overlap metrics).
- 2026-02-10T18:04:38.5979151+00:00 | Restarted backend runtime at http://127.0.0.1:8001 and verified health endpoint returns {"status":"ok"}.
- 2026-02-10T18:10:25.1707301+00:00 | Investigated map-layer misalignment: diagnosed latitude-axis inversion from metadata (target_lat ascending 60->80 while raster rows are north->south), causing bathy/UNet/heatmap vertical flip symptoms.
- 2026-02-10T18:10:25.1707301+00:00 | Updated backend/app/core/geo.py to normalize metadata latitude axes to descending order and to build AOI fallback latitude axis as max->min.
- 2026-02-10T18:10:25.1707301+00:00 | Enhanced backend/app/core/render.py sampling: kept nearest-neighbor for categorical layers (bathy/unet), added bilinear interpolation for continuous layers (ais/ice/wave/wind) to reduce block artifacts.
- 2026-02-10T18:10:25.1707301+00:00 | Added AOI framing rectangle on map in frontend/src/components/MapCanvas.tsx so users can see the NSR data extent over basemap.
- 2026-02-10T18:10:25.1707301+00:00 | Added regression tests backend/tests/test_render_sampling.py and extended backend/tests/test_geo_mapping.py for metadata latitude normalization behavior.
- 2026-02-10T18:10:25.1707301+00:00 | Validation: python -m pytest -q (backend) -> 37 passed; npm run build (frontend) succeeded; backend /healthz OK after restart.
- 2026-02-10T18:13:55.0198695+00:00 | Enhanced gallery record schema in backend/app/api/routes_plan.py: each route run now stores structured `action` (planning input/policy) and `result` (status/metrics/point-count/snap flags) plus `timeline` events.
- 2026-02-10T18:13:55.0198695+00:00 | Updated frontend gallery types in frontend/src/api/client.ts and upgraded frontend/src/pages/ExportReport.tsx list cards to focus on action+result summaries.
- 2026-02-10T18:13:55.0198695+00:00 | Added hover-detail panels (HoverCard) on gallery run items to show detailed policy and route-result metrics on mouse-over.
- 2026-02-10T18:13:55.0198695+00:00 | Added backend API regression assertion in backend/tests/test_api_smoke.py for gallery action/result/timeline fields after route planning.
- 2026-02-10T18:13:55.0198695+00:00 | Validation: python -m pytest -q (backend) -> 37 passed; npm run build (frontend) succeeded; backend restarted and /healthz returned ok.
- 2026-02-10T18:15:29.0964668+00:00 | Added dataset month alias handling in backend/app/core/dataset.py: /v1/timestamps now treats month=all (or *) as full 2024-07~2024-10 timestamp set.
- 2026-02-10T18:15:29.0964668+00:00 | Updated frontend/src/pages/ScenarioSelector.tsx dataset selector to include `all` option and request full timestamp list when selected.
- 2026-02-10T18:15:29.0964668+00:00 | Added backend API regression test test_timestamps_all_alias_returns_full_set in backend/tests/test_api_smoke.py.
- 2026-02-10T18:15:29.0964668+00:00 | Validation: python -m pytest -q (backend) -> 38 passed; npm run build (frontend) succeeded.
- 2026-02-10T20:24:16.5276922+00:00 | Fixed continuous-layer land spillover in backend/app/core/render.py: ice/wave/wind/ais rendering now applies sea-only mask from bathy blocked grid (land pixels forced transparent).
- 2026-02-10T20:24:16.5276922+00:00 | Extended backend/tests/test_render_sampling.py with test_render_continuous_respects_value_mask to guard masking behavior.
- 2026-02-10T20:24:16.5276922+00:00 | Validation: python -m pytest -q (backend) -> 39 passed.
- 2026-02-10T20:24:16.5276922+00:00 | Restarted backend server on http://127.0.0.1:8001 and verified /healthz returns ok.
- 2026-02-10T20:29:48.0550141+00:00 | Located desktop logo source C:/Users/cai yuan qi/Desktop/roundLOGO.png and generated center-cropped app logo asset (52% center crop) as frontend/src/assets/app-logo.png.
- 2026-02-10T20:29:48.0550141+00:00 | Added browser favicon asset frontend/public/favicon.png derived from cropped logo.
- 2026-02-10T20:29:48.0550141+00:00 | Replaced top-left header icon in frontend/src/components/Layout.tsx with the new cropped logo image.
- 2026-02-10T20:29:48.0550141+00:00 | Updated frontend/index.html to use /favicon.png as application icon.
- 2026-02-10T20:29:48.0550141+00:00 | Validation: npm run build (frontend) succeeded; python -m pytest -q (backend) -> 39 passed.
- 2026-02-10T20:35:09.6760197+00:00 | Mobile adaptation pass: improved small-screen layout/scroll behavior in frontend/src/components/Layout.tsx, frontend/src/pages/ScenarioSelector.tsx, frontend/src/pages/MapWorkspace.tsx, and frontend/src/pages/ExportReport.tsx (responsive stacking, panel sizing, mobile-safe controls/buttons).
- 2026-02-10T20:35:09.6760197+00:00 | Added Render deployment blueprint file render.yaml (FastAPI web service + static frontend service with SPA rewrite and env var placeholders).
- 2026-02-10T20:35:09.6760197+00:00 | Added DEPLOY_RENDER.md with step-by-step Render deployment and required env var/data-path notes.
- 2026-02-10T20:35:09.6760197+00:00 | Updated .gitignore to ignore frontend/.env.local and frontend/.env.*.local.
- 2026-02-10T20:35:09.6760197+00:00 | Validation: npm run build (frontend) succeeded.
- 2026-02-10T20:35:09.6760197+00:00 | Validation: python -m pytest -q (backend) -> 39 passed.
- 2026-02-10T20:37:55.3755409+00:00 | Investigated ice-layer visibility issue: measured annotation_pack ice channel coverage and found many timestamps contain NaN over open sea, causing transparent rendering in current pipeline.
- 2026-02-10T20:37:55.3755409+00:00 | Updated backend/app/core/render.py ice rendering path: added _normalize_ice_sampled() to map NaN/inf/negative to 0 (clear water), and increased low-end ice alpha (35-180) for better map visibility at max opacity.
- 2026-02-10T20:37:55.3755409+00:00 | Added regression test backend/tests/test_render_sampling.py::test_normalize_ice_sampled_fills_non_finite_as_zero.
- 2026-02-10T20:37:55.3755409+00:00 | Validation: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T20:41:10.2810133+00:00 | Pre-submit validation before GitHub push: npm run build (frontend) succeeded.
- 2026-02-10T20:41:10.2810133+00:00 | Pre-submit validation before GitHub push: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T20:41:38.4607276+00:00 | Created commit 10ffc62: mobile responsive improvements, Render deployment config/docs, and ice-layer NaN visibility fix.
- 2026-02-10T20:41:38.4607276+00:00 | Pushed commit 10ffc62 to origin/main (https://github.com/Cassian2006/NSR2.git).
- 2026-02-10T20:42:09.8523456+00:00 | Pre-submit validation before log-sync push: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T20:49:54.1383901+00:00 | Fixed Blueprint schema in render.yaml for Render compatibility: changed backend service key from runtime->env (python) and frontend service type from web/runtime:static to type:static.
- 2026-02-10T20:50:37.1704382+00:00 | Pre-submit validation before Blueprint-fix push: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T20:51:59.2742179+00:00 | Fixed Render Blueprint compatibility for accounts rejecting type=static: updated render.yaml frontend service to type=web + runtime=static; reverted backend service key to runtime=python.
- 2026-02-10T20:51:59.2742179+00:00 | Updated DEPLOY_RENDER.md wording to match runtime:static blueprint setup.
- 2026-02-10T20:56:44.3500366+00:00 | Pre-submit validation before Render-blueprint-fix push: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T21:00:00.8392143+00:00 | Hardened render.yaml for Blueprint compatibility: removed optional env vars that may fail schema checks and switched frontend VITE_API_BASE_URL to fromService(RENDER_EXTERNAL_URL) wiring.
- 2026-02-10T21:00:00.8392143+00:00 | Updated frontend/src/api/client.ts to normalize VITE_API_BASE_URL by auto-appending /v1 when env value is a bare origin.
- 2026-02-10T21:00:00.8392143+00:00 | Updated DEPLOY_RENDER.md to reflect fromService-based API URL wiring and /v1 auto-normalization.
- 2026-02-10T21:00:30.4467450+00:00 | Validation after Blueprint-compat hardening: npm run build (frontend) succeeded.
- 2026-02-10T21:00:30.4467450+00:00 | Validation after Blueprint-compat hardening: python -m pytest -q (backend) -> 40 passed.
- 2026-02-10T21:01:59.5745857+00:00 | Fixed workspace responsive behavior: switched desktop breakpoint from lg->md and repaired map height chain (h-full/min-h-0) in frontend/src/pages/MapWorkspace.tsx so desktop uses horizontal layout and map container renders correctly.
- 2026-02-10T21:01:59.5745857+00:00 | Updated top navigation responsive breakpoint from lg->md in frontend/src/components/Layout.tsx to avoid unintended mobile-style stacking on common desktop widths.
- 2026-02-10T21:01:59.5745857+00:00 | Validation: npm run build (frontend) succeeded.
- 2026-02-10T21:03:41.1778425+00:00 | Pre-submit validation before responsive-layout push: python -m pytest -q (backend) -> 40 passed.
