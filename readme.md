# NSR é¿é™©èˆªçº¿è§„åˆ’ç³»ç»Ÿï¼ˆå½“å‰å®ç°è¯´æ˜ï¼‰

æœ€åæ›´æ–°ï¼š2026-02-11  
æŠ€æœ¯æ ˆï¼šReact + Vite + FastAPI + Python

---

## 1. é¡¹ç›®ç›®æ ‡
åœ¨ç»™å®šæ—¶é—´ç‰‡ä¸‹ï¼ŒåŸºäºç¯å¢ƒç½‘æ ¼ï¼ˆå†°/æµª/é£ï¼‰ã€æ°´æ·±ç¦è¡Œã€AIS èµ°å»Šçƒ­åŠ›å›¾ä¸ U-Net åˆ†åŒºç»“æœï¼Œå®Œæˆï¼š

- å¤šå›¾å±‚åœ°å›¾å±•ç¤ºä¸å åŠ 
- èµ·ç»ˆç‚¹äº¤äº’å¼é€‰å–ä¸è·¯çº¿è§„åˆ’
- è·¯çº¿ç»“æœå¯è§£é‡Šï¼ˆè·ç¦»/é£é™©/èµ°å»Šè´´åˆï¼‰
- è§„åˆ’ç»“æœè½ç›˜åˆ° Galleryï¼ˆå«æˆªå›¾ï¼‰
- AIS å›æµ‹æŒ‡æ ‡è¾“å‡º

---

## 2. å½“å‰åŠŸèƒ½å®Œæˆåº¦

### åç«¯æ¥å£ï¼ˆå·²å¯ç”¨ï¼‰
- `GET /healthz`
- `GET /v1/datasets`
- `GET /v1/datasets/quality`
- `GET /v1/timestamps`
- `GET /v1/layers`
- `GET /v1/overlay/{layer}.png`
- `GET /v1/tiles/{layer}/{z}/{x}/{y}.png`
- `POST /v1/infer`
- `POST /v1/route/plan`
- `POST /v1/route/plan/dynamic`
- `POST /v1/latest/plan`
- `GET /v1/latest/progress`
- `GET /v1/latest/runtime`
- `GET /v1/latest/sources/health`
- `GET/POST /v1/latest/copernicus/config`
- `GET /v1/latest/status`
- `GET /v1/gallery/list`
- `GET /v1/gallery/{id}`
- `GET /v1/gallery/{id}/image.png`
- `POST /v1/gallery/{id}/image`
- `DELETE /v1/gallery/{id}`
- `POST /v1/eval/ais/backtest`

### å‰ç«¯é¡µé¢ï¼ˆå·²å¯ç”¨ï¼‰
- `ScenarioSelector`ï¼šåœºæ™¯ä¸æ—¶é—´ç‰‡é€‰æ‹©
- `MapWorkspace`ï¼šåœ°å›¾å·¥ä½œå°ã€å›¾å±‚æ§åˆ¶ã€è§„åˆ’ã€æ¨ç†ã€latest è¿›åº¦æ¡
- `ExportReport`ï¼šGallery æµè§ˆã€ä¸‹è½½ã€åˆ é™¤ã€AIS å›æµ‹

### è§„åˆ’ç®—æ³•ï¼ˆå·²é›†æˆï¼‰
- A*ï¼ˆåŸºçº¿ï¼‰
- D* Liteï¼ˆé™æ€ + åŠ¨æ€å¢é‡é‡è§„åˆ’ï¼‰
- Any-Angle / Theta*
- Hybrid A*

---

## 3. æœ¬è½®å…³é”®æ›´æ–°ï¼ˆå·²è½åœ°ï¼‰

### åœ°å›¾ä¸å›¾å±‚ç¨³å®šæ€§
- ä¿®å¤åœ°å›¾åˆ·æ–°åå¯èƒ½ç©ºç™½çš„é—®é¢˜ï¼šæ¡Œé¢å¸ƒå±€é«˜åº¦æ”¹ä¸º `100dvh`ï¼Œåœ°å›¾å®¹å™¨å¢åŠ æœ€å°é«˜åº¦ä¿æŠ¤ã€‚
- ä¿®å¤å›¾å±‚â€œçœ‹ä¼¼ç¼ºå¤±â€é—®é¢˜ï¼šæ–°å¢ç“¦ç‰‡ç‰ˆæœ¬å· `tileRevision`ï¼Œé¿å…æµè§ˆå™¨ç¼“å­˜æ—§é€æ˜ç“¦ç‰‡ã€‚
- `MapContainer` åœ¨å¸ƒå±€/æ—¶é—´ç‰‡åˆ‡æ¢æ—¶å®‰å…¨é‡å»ºï¼Œé¿å… Leaflet å°ºå¯¸ä¸åŒæ­¥ã€‚

### éƒ¨ç½²æ•°æ®ç­–ç•¥
- Docker é»˜è®¤åˆ‡ä¸ºå…¨é‡æ•°æ®ä¼˜å…ˆï¼š
  - `NSR_DATA_ROOT=/app/data`
  - `NSR_OUTPUTS_ROOT=/app/outputs`
  - `NSR_ALLOW_DEMO_FALLBACK=0`
- ä¸å†é»˜è®¤é™é»˜å›é€€ demo æ•°æ®ï¼Œé¿å…çº¿ä¸Šè¯¯ç”¨å‹ç¼©æ ·æœ¬ã€‚

### æ•°æ®è´¨é‡æŠ¥å‘Šè§„åˆ™
- è´¨é‡è§„åˆ™å·²è°ƒä¼˜ï¼Œé¿å…æŠŠâ€œæŒ‰éœ€æ¨ç†â€åœºæ™¯è¯¯åˆ¤ä¸ºå¤±è´¥ï¼š
  - `auxiliary_layers_coverage`ï¼šAIS è¦†ç›–é«˜æ—¶ï¼Œ`pred/uncertainty` ä½è¦†ç›–è®°ä¸º `WARN` è€Œé `FAIL`
  - `numeric_quality_sampled`ï¼šå¢åŠ æµ·åŸŸ/é™†åœ° NaN ç»Ÿè®¡ï¼Œä½¿ç”¨åˆ†çº§é˜ˆå€¼

---

## 4. æ•°æ®è´¨é‡ç°çŠ¶ï¼ˆå½“å‰æ•°æ®é›†ï¼‰

- æ€»ä½“çŠ¶æ€ï¼š`WARN`ï¼ˆåŸå…ˆ `FAIL` å·²ä¿®æ­£ä¸ºæ›´çœŸå®è¯„ä¼°ï¼‰
- æ—¶é—´ç‰‡æ•°é‡ï¼š`493`
- æ—¶é—´èŒƒå›´ï¼š`2024-07-01_00` -> `2025-02-02_12`
- å½“å‰å‘Šè­¦é¡¹ï¼ˆ2ï¼‰ï¼š
  - `auxiliary_layers_coverage`
  - `numeric_quality_sampled`

è¯´æ˜ï¼šè¿™ä¸¤ä¸ªå‘Šè­¦ä¸é˜»å¡ç³»ç»Ÿè¿è¡Œï¼Œå±äºâ€œç”Ÿäº§å¯è¿è¡Œ + éœ€è¦æŒç»­ä¼˜åŒ–â€çŠ¶æ€ã€‚

---

## 5. ç›®å½•ç»“æ„ï¼ˆæ ¸å¿ƒï¼‰

```text
NSR2/
  backend/
    app/
      api/
      core/
      eval/
      model/
      planning/
      main.py
    tests/
    requirements.txt
  frontend/
    src/
      pages/
      components/
      api/
  data/
  outputs/
  Dockerfile
  DEPLOY_RENDER.md
  readme.md
  agent.md
```

---

## 6. æœ¬åœ°è¿è¡Œ

### åç«¯
```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --host 127.0.0.1 --port 8000
```

### å‰ç«¯
```bash
cd frontend
npm install
npm run dev -- --host 127.0.0.1 --port 5173
```

é»˜è®¤å‰ç«¯ API å»ºè®®ï¼š
- `frontend/.env.local`ï¼š
  - `VITE_API_BASE_URL=http://127.0.0.1:8000/v1`

---

## 7. ç¾¤æ™– NASï¼ˆDSMï¼‰éƒ¨ç½²å»ºè®®

æ¨èç›®å½•ï¼š

- `/volume1/NSRplanner/app`ï¼ˆä»“åº“ä»£ç ï¼Œå« Dockerfileï¼‰
- `/volume1/NSRplanner/data`ï¼ˆçœŸå®æ•°æ®ï¼‰
- `/volume1/NSRplanner/outputs`ï¼ˆè¿è¡Œè¾“å‡ºï¼‰

`docker-compose.yml` å»ºè®®ï¼š

```yaml
services:
  nsr2:
    build:
      context: ./app
      dockerfile: Dockerfile
    container_name: nsr2
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      PORT: "8000"
      NSR_DATA_ROOT: "/app/data"
      NSR_OUTPUTS_ROOT: "/app/outputs"
      NSR_ALLOW_DEMO_FALLBACK: "0"
      NSR_DISABLE_TORCH: "1"
    volumes:
      - /volume1/NSRplanner/data:/app/data:ro
      - /volume1/NSRplanner/outputs:/app/outputs
```

å¯åŠ¨åå…ˆæ£€æŸ¥ï¼š

- `http://NAS_IP:8000/healthz`
- `http://NAS_IP:8000/v1/datasets`ï¼ˆ`sample_count` å¿…é¡» > 0ï¼‰

å»ºè®®å†æ‰§è¡Œä¸€æ¬¡è‡ªåŠ¨å·¡æ£€ï¼ˆå¯åŠ¨å 20~40 ç§’ï¼‰ï¼š

```bash
cd backend
python scripts/nas_runtime_healthcheck.py \
  --base-url http://NAS_IP:8000 \
  --min-sample-count 1 \
  --probe-count 12 \
  --out-dir outputs/qa
```

å·¡æ£€è„šæœ¬é»˜è®¤ä¼šæ£€æŸ¥ï¼š

- `/healthz` å­˜æ´»
- `/v1/datasets` çš„ `sample_count`
- `/v1/timestamps` æ˜¯å¦éç©º
- `/v1/layers` çš„å…³é”®å›¾å±‚å¯ç”¨æ€§ï¼ˆ`bathy/ais_heatmap/unet_pred/unet_uncertainty`ï¼‰
- å…³é”®å›¾å±‚ overlay æ¸²æŸ“å¯è®¿é—®ï¼ˆè¿”å› `image/png` ä¸”å­—èŠ‚æ•°è¾¾æ ‡ï¼‰

é€€å‡ºç çº¦å®šï¼š

- `0`ï¼šPASS
- `1`ï¼šWARNï¼ˆä»…å‘Šè­¦ï¼‰
- `2`ï¼šFAILï¼ˆå…³é”®é¡¹å¤±è´¥ï¼‰

å¦‚éœ€æŠŠ WARN è§†ä¸ºé€šè¿‡ï¼ˆä¾‹å¦‚ Docker/DSM å¥åº·æ£€æŸ¥ï¼‰ï¼Œå¢åŠ ï¼š

- `--warn-exit-zero`

---

## 8. æäº¤ä¸è´¨é‡é—¨ç¦ï¼ˆæ‰§è¡Œè§„åˆ™ï¼‰

- æ¯æ¬¡æäº¤ GitHub å‰å¿…é¡»æ‰§è¡Œå®¡æŸ¥ä¸æµ‹è¯•ï¼š
  - `python -m pytest -q`ï¼ˆbackendï¼‰
  - å‰ç«¯æœ‰æ”¹åŠ¨æ—¶æ‰§è¡Œ `npm run build`ï¼ˆfrontendï¼‰
- æ‰€æœ‰å…³é”®æ“ä½œå†™å…¥ `agent.md`ï¼ˆå«æ—¶é—´æˆ³ï¼‰
- é˜¶æ®µåŠŸèƒ½å®ŒæˆååŠæ—¶æäº¤å¹¶æ¨é€

---

## 9. ä¸‹ä¸€æ­¥å»ºè®®

- è¡¥å…¨ `unet_pred/unet_uncertainty` çš„å†å²ç¼“å­˜è¦†ç›–ç‡ï¼ˆé™ä½å‘Šè­¦ï¼‰
- ç»§ç»­ä¼˜åŒ– latest æ‹‰å–é“¾è·¯ä¸é”™è¯¯æ¢å¤ï¼ˆCopernicus ä¸ç¨³å®šåœºæ™¯ï¼‰
- å°† NAS å·¡æ£€è„šæœ¬æ¥å…¥ DSM è®¡åˆ’ä»»åŠ¡ï¼ˆå¼€æœºåå»¶è¿Ÿæ‰§è¡Œå¹¶ä¿ç•™æœ€è¿‘ 7 å¤©æŠ¥å‘Šï¼‰

---

## 10. ä¸‰ä¸ªæ·±å…¥å‡çº§æ–¹å‘ï¼ˆè·¨å­¦ç§‘ + åˆ›æ–°ï¼‰

### æ–¹å‘ Aï¼šä¸ç¡®å®šæ€§é©±åŠ¨çš„é²æ£’èˆªçº¿è§„åˆ’

ç›®æ ‡ï¼šä»â€œå•ä¸€æœ€çŸ­è·¯â€å‡çº§ä¸ºâ€œé£é™©åˆ†å¸ƒæœ€ä¼˜è·¯å¾„â€ã€‚

- åˆ›æ–°ç‚¹ï¼š
  - å°† `U-Net uncertainty` ä¸ `latest` æ—¶åºç¯å¢ƒé¢„æµ‹è€¦åˆæˆæ¦‚ç‡é£é™©åœºã€‚
  - åœ¨è§„åˆ’å±‚å¼•å…¥ `CVaR / chance-constrained` æ€è·¯ï¼Œè¾“å‡ºä¿å®ˆ-å¹³è¡¡-æ¿€è¿›ä¸‰ç§ç­–ç•¥ã€‚
- å·¥ç¨‹è½åœ°ï¼š
  - API å¢åŠ  `risk_mode`ã€`risk_budget`ã€`confidence_level`ã€‚
  - å‰ç«¯å±•ç¤ºâ€œé£é™©èµ°å»Šå¸¦ + å¤šå€™é€‰è·¯å¾„ + é£é™©åŒºé—´æ¡â€ã€‚
  - è¯„ä¼°æ–°å¢ï¼š`risk_violation_rate`ã€`expected_delay`ã€`route_robustness`ã€‚

### æ–¹å‘ Bï¼šå¯è§£é‡Šä¸»åŠ¨å­¦ä¹ çš„äººæœºååŒé—­ç¯

ç›®æ ‡ï¼šé™ä½æ ‡æ³¨æˆæœ¬ï¼ŒåŒæ—¶æå‡æ ‡ç­¾ä¸€è‡´æ€§ä¸æ¨¡å‹æ³›åŒ–ã€‚

- åˆ›æ–°ç‚¹ï¼š
  - ä¸»åŠ¨å­¦ä¹ æ ·æœ¬æŒ‰â€œé«˜ä¸ç¡®å®š + é«˜è·¯çº¿å½±å“â€è”åˆæ’åºï¼Œè€Œä¸æ˜¯åªçœ‹ä¸ç¡®å®šæ€§ã€‚
  - æ¯ä¸ªå»ºè®®åŒºåŸŸæä¾›è§£é‡Šä¿¡å·ï¼ˆå†°/é£/æµªè´¡çŒ®ã€AIS åç¦»åº¦ã€å†å²è¯¯åˆ¤ç±»å‹ï¼‰ã€‚
- å·¥ç¨‹è½åœ°ï¼š
  - æ ‡æ³¨ç«¯å¢åŠ â€œå»ºè®®åŸå› å¡ç‰‡ + ä¸€é”®æ¥å—/å±€éƒ¨ä¿®è®¢â€ã€‚
  - è®­ç»ƒç«¯å¼•å…¥ `focal + dice`ã€å›°éš¾æ ·æœ¬é‡é‡‡æ ·ã€ç±»åˆ«æƒé‡è‡ªé€‚åº”ã€‚
  - è´¨é‡é—­ç¯æŒ‡æ ‡ï¼šæ¯è½®æ–°å¢æ ‡æ³¨å¯¹åº”çš„ `val_iou`ã€`route_safety` å¢ç›Šã€‚

### æ–¹å‘ Cï¼šæ—¶åºæ•°å­—å­ªç”Ÿä¸å¢é‡é‡è§„åˆ’åŸºçº¿

ç›®æ ‡ï¼šå‘æŒ¥ `D* Lite` ä¼˜åŠ¿ï¼Œä»é™æ€è§„åˆ’å‡çº§åˆ°åŠ¨æ€è¿ç»­å†³ç­–ã€‚

- åˆ›æ–°ç‚¹ï¼š
  - åŸºäºæ—¶é—´æ­¥ç¯å¢ƒæ›´æ–°è§¦å‘å±€éƒ¨å¢é‡é‡è§„åˆ’ï¼Œæ„å»ºâ€œåŠ¨æ€èˆªç¨‹å›æ”¾â€æ¡†æ¶ã€‚
  - åŒåœºæ™¯å¯¹æ¯” `A* / D* Lite / Any-angle / Hybrid A*` çš„æ”¶ç›Šè¾¹ç•Œã€‚
- å·¥ç¨‹è½åœ°ï¼š
  - æ‰©å±• `route/plan/dynamic` ä¸ºå¤šæ—¶é—´æ­¥æ‰¹é‡æ¨¡å¼ä¸äº‹ä»¶æ—¥å¿—è¾“å‡ºã€‚
  - å‰ç«¯å¢åŠ æ—¶é—´è½´å›æ”¾ã€é‡è§„åˆ’è§¦å‘ç‚¹ã€è·¯å¾„æ¼”åŒ–å¯¹æ¯”ã€‚
  - åŸºå‡†æµ‹è¯•æ–°å¢ï¼šé‡è§„åˆ’æ¬¡æ•°ã€ç¨³å®šæ€§ã€é£é™©æš´éœ²ç§¯åˆ†ã€å•ä½æ—¶é—´ç®—åŠ›æˆæœ¬ã€‚

---

## 11. æ–¹å‘ B æ‰§è¡Œæ¸…å•ï¼ˆé€æ¡äº¤ä»˜ + æµ‹è¯•éªŒæ”¶ï¼‰

æ‰§è¡Œé¡ºåºå»ºè®®ï¼š`B1 -> B2 -> B3 -> B4 -> B5 -> B6 -> B7 -> B8 -> B9 -> B10`ã€‚

### B1. æ ‡æ³¨è´¨æ£€è§„åˆ™ v1ï¼ˆæ•°æ®å…¥å£æŠŠå…³ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - æ–°å¢æ ‡æ³¨è´¨æ£€è„šæœ¬ï¼Œæ£€æŸ¥ç©ºæ ‡æ³¨ã€å¼‚å¸¸å°åŒºåŸŸã€`caution/blocked` å†²çªã€æ ‡ç­¾è¶Šç•Œã€‚
  - ç”Ÿæˆ `json + md` è´¨æ£€æŠ¥å‘Šï¼ˆå¯è¿½æº¯åˆ°æ ·æœ¬ IDï¼‰ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `python -m pytest -q tests/test_train_quality.py`
  - `python scripts/qc_unet_manifest.py` æ‰§è¡ŒæˆåŠŸå¹¶è¾“å‡ºæŠ¥å‘Šæ–‡ä»¶ã€‚

### B2. ä¸»åŠ¨å­¦ä¹ æ’åºå™¨ v2ï¼ˆä¸ç¡®å®šæ€§ + è·¯çº¿å½±å“ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - å°†æ ·æœ¬ä¼˜å…ˆçº§ç”±â€œä»…ä¸ç¡®å®šæ€§â€å‡çº§ä¸ºâ€œ`uncertainty + route_impact + class_balance`â€è”åˆè¯„åˆ†ã€‚
  - è¾“å‡º Top-K å»ºè®®æ ·æœ¬åŠè¯„åˆ†åˆ†è§£é¡¹ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `python -m pytest -q tests/test_active_learning_suggest.py`
  - `python scripts/active_learning_suggest.py --top-k 20` å¯äº§å‡ºæ’åºç»“æœã€‚

### B3. å¯è§£é‡Šå»ºè®®ä¿¡å·ï¼ˆåŸå› åˆ†è§£ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - ä¸ºæ¯ä¸ªå»ºè®®æ ·æœ¬è¾“å‡ºè§£é‡Šå­—æ®µï¼šå†°/é£/æµªè´¡çŒ®ã€AIS åç¦»ã€å†å²è¯¯åˆ¤é£é™©ã€‚
  - è½ç›˜è§£é‡Šå¿«ç…§ï¼ˆ`json` + å¯è§†åŒ–å›¾ï¼‰ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - æ–°å¢è§£é‡Šæ¨¡å—å•æµ‹ï¼ˆè´¡çŒ®å€¼éè´Ÿã€æ€»å’Œä¸€è‡´ã€å­—æ®µå®Œæ•´ï¼‰ã€‚
  - éšæœºæŠ½æ · 5 ä¸ªæ ·æœ¬ï¼Œè§£é‡Šæ–‡ä»¶å‡å¯è¯»å–ã€‚

### B4. æ ‡æ³¨ä»»åŠ¡åŒ…è‡ªåŠ¨ç”Ÿæˆï¼ˆå¯ç›´æ¥å¼€å·¥ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - ç”Ÿæˆ `riskhint + landmask + blocked overlay` çš„æ ‡æ³¨åŒ…ç›®å½•ã€‚
  - æ”¯æŒæŒ‰æ‰¹æ¬¡å¯¼å‡ºï¼ˆä¾‹å¦‚æ¯æ‰¹ 20 å¼ ï¼‰ä¸ç»­æ ‡ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `python scripts/prepare_unet_annotation_pack.py` æˆåŠŸç”Ÿæˆæ‰¹æ¬¡ç›®å½•ã€‚
  - æ‰¹æ¬¡å†…æ–‡ä»¶åã€æ˜ å°„æ¸…å•ã€å›¾åƒæ•°é‡ä¸€è‡´ã€‚

### B5. æ ‡æ³¨ç«¯â€œå»ºè®®åŸå› å¡ç‰‡ + ä¸€é”®æ¥å—/ä¿®è®¢â€
- [x] å®ç°å†…å®¹ï¼š
  - å‰ç«¯æ˜¾ç¤ºå»ºè®®åŸå› å¡ç‰‡ï¼ˆç½®ä¿¡åº¦ã€è´¡çŒ®æ¥æºã€æ¨èåŠ¨ä½œï¼‰ã€‚
  - å¢åŠ â€œæ¥å—å»ºè®® / å±€éƒ¨ä¿®è®¢â€çŠ¶æ€è®°å½•ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `cd frontend && npm run build` é€šè¿‡ã€‚
  - æ‰‹å·¥éªŒæ”¶ï¼šèƒ½çœ‹åˆ°åŸå› å¡ç‰‡ï¼Œç‚¹å‡»æ“ä½œåçŠ¶æ€å¯æŒä¹…åŒ–ã€‚

### B6. è®­ç»ƒæŸå¤±å‡çº§ï¼ˆfocal + dice + ç±»åˆ«æƒé‡ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - è®­ç»ƒé…ç½®æ”¯æŒ `focal + dice` ç»„åˆæŸå¤±ä¸ç±»åˆ«æƒé‡ã€‚
  - æ”¯æŒé…ç½®åˆ‡æ¢å¹¶è®°å½•å®éªŒå‚æ•°ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `python -m pytest -q tests/test_losses.py`
  - è®­ç»ƒè„šæœ¬ 1 ä¸ªçŸ­è½®æ¬¡ smoke run æˆåŠŸã€‚

### B7. å›°éš¾æ ·æœ¬é‡é‡‡æ ·ï¼ˆhard example replayï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - åŸºäºè¯¯å·®/ä¸ç¡®å®šæ€§åˆ†æ•°å»ºç«‹å›°éš¾æ ·æœ¬æ± ï¼Œè®­ç»ƒæ—¶æŒ‰æ¯”ä¾‹é‡æ”¾ã€‚
  - æ”¯æŒé‡é‡‡æ ·æ¯”ä¾‹å’Œä¸Šé™é…ç½®ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - æ–°å¢é‡‡æ ·å™¨å•æµ‹ï¼ˆæŠ½æ ·åˆ†å¸ƒç¬¦åˆé¢„æœŸï¼‰ã€‚
  - è®­ç»ƒæ—¥å¿—å¯çœ‹åˆ° hard pool å‘½ä¸­ç‡æŒ‡æ ‡ã€‚

### B8. ä¸ç¡®å®šæ€§æ ¡å‡†ä¸å¯è§†åŒ–
- [x] å®ç°å†…å®¹ï¼š
  - å¢åŠ æ¸©åº¦ç¼©æ”¾æˆ–ç­‰ä»·æ ¡å‡†æ–¹æ³•ï¼Œè¾“å‡ºæ ¡å‡†å‰åå¯¹æ¯”ã€‚
  - å‰ç«¯æˆ–æŠ¥å‘Šå±•ç¤ºä¸ç¡®å®šæ€§çƒ­å›¾ä¸é˜ˆå€¼å»ºè®®ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - æ–°å¢æ ¡å‡†å•æµ‹ï¼ˆECE/Brier è‡³å°‘ä¸€ä¸ªæŒ‡æ ‡æ”¹å–„æˆ–å¯è¿½è¸ªï¼‰ã€‚
  - ç”Ÿæˆ 1 ä»½æ ¡å‡†è¯„ä¼°æŠ¥å‘Šã€‚

### B9. é—­ç¯è¯„ä¼°æŠ¥å‘Šï¼ˆæ ‡æ³¨ -> è®­ç»ƒ -> è§„åˆ’æ”¶ç›Šï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - å›ºåŒ–å‰åå¯¹æ¯”æŠ¥å‘Šï¼š`val_iou`ã€`route_safety`ã€`route_length_delta`ã€`inference_time`ã€‚
  - è¾“å‡ºç»Ÿä¸€æ¨¡æ¿æŠ¥å‘Šç”¨äºè®ºæ–‡/ç­”è¾©ææ–™ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - `python scripts/report_data_quality.py` ä¸è¯„ä¼°è„šæœ¬å¯ä¸²è”è·‘é€šã€‚
  - ç”Ÿæˆä¸€ä»½å®Œæ•´å¯¹æ¯”æŠ¥å‘Šï¼ˆå«ç»“è®ºæ®µï¼‰ã€‚

### B10. ä¸€é”®é—­ç¯æµæ°´çº¿ï¼ˆå·¥ç¨‹åŒ–ï¼‰
- [x] å®ç°å†…å®¹ï¼š
  - æä¾›ä¸€æ¡å‘½ä»¤ä¸²è”ï¼šè´¨æ£€ -> å»ºè®® -> æ ‡æ³¨åŒ… -> è®­ç»ƒ -> è¯„ä¼° -> æŠ¥å‘Šã€‚
  - å¢åŠ å¤±è´¥é‡è¯•ä¸æ–­ç‚¹ç»­è·‘ï¼ˆæœ€å°‘åœ¨å»ºè®®/è®­ç»ƒé˜¶æ®µæ”¯æŒï¼‰ã€‚
- [x] æµ‹è¯•éªŒæ”¶ï¼š
  - å…¨é“¾è·¯è„šæœ¬åœ¨å°æ ·æœ¬é›†ä¸Šå¯è·‘é€šã€‚
  - `python -m pytest -q` å…¨éƒ¨é€šè¿‡åå†æäº¤ GitHubã€‚

---

## 12. ĞÂÔö£º±ê×¢¹¤×÷Ì¨£¨Web ±ê×¢±Õ»·£©

±¾´ÎĞÂÔöÓë¡°µØÍ¼¹¤×÷Ì¨¡±²¢ÁĞµÄ¡°±ê×¢¹¤×÷Ì¨¡±£¨`/annotation`£©£¬ÓÃÓÚ¼õÉÙ Labelme À´»ØÇĞ»»³É±¾¡£

### ¹¦ÄÜ
- ÔÚ Web µØÍ¼ÉÏÒÔ¶à±ßĞÎ·½Ê½Ö´ĞĞ£º`»­ caution` / `²Á³ı caution`¡£
- Ö§³Öµş¼Ó²é¿´£º`bathy`¡¢`ais_heatmap`¡¢`unet_pred`¡¢`caution_mask`¡£
- Ö§³Ö´ÓÖ÷¶¯Ñ§Ï°½¨ÒéÅú´ÎÒ»¼üÌø×ªÊ±¼äÆ¬£¨½öÌø×ª£¬²»Ìæ´úÈË¹¤ÅĞ¶Ï£©¡£
- ±£´æÊ±ºó¶Ë×Ô¶¯Ö´ĞĞ£º
  - ÂäÅÌ `caution_mask.npy`
  - ºÏ³É `y_class.npy`£¨0=SAFE, 1=CAUTION, 2=BLOCKED£»BLOCKED ÓÅÏÈ£©
  - ¼ÇÂ¼ patch ÎÄ¼ş£º`outputs/annotation_workspace/patches/{timestamp}.json`

### ĞÂÔö½Ó¿Ú
- `GET /v1/annotation/workspace/patch?timestamp=...`
- `POST /v1/annotation/workspace/patch`

### ÑéÊÕ
- `backend`: `python -m pytest -q`£¨º¬ `test_annotation_workspace.py`£©
- `frontend`: `npm run build`
- ĞÂÔö»­±ÊÄ£Ê½£¨stroke£©£º°´×¡Êó±êÍÏ¶¯¼´¿ÉÁ¬ĞøÍ¿Ä¨/²Á³ı caution£¬Ö§³Ö´ÖÏ¸£¨Õ¤¸ñ°ë¾¶£©µ÷½Ú¡£

---

## 13. ·½Ïò A Ö´ĞĞÇåµ¥£¨½ö¹æ»®£¬²»Ö´ĞĞ£©

Ö´ĞĞË³Ğò½¨Òé£º`A1 -> A2 -> A3 -> A4 -> A5 -> A6 -> A7 -> A8 -> A9 -> A10`

### A1. ·çÏÕ×Ö¶ÎÊı¾İÆõÔ¼ÓëÄ¿Â¼¹æ·¶
- [ ] ÊµÏÖÄÚÈİ£º
  - ¶¨ÒåÍ³Ò»·çÏÕ×Ö¶Î½á¹¹£º`risk_mean/risk_p90/risk_std/uncertainty`£¨`H x W`£¬`float32`£©¡£
  - Í³Ò»ÂäÅÌÄ¿Â¼£º`outputs/risk_fields/{version}/{timestamp}.npz` Óë `meta.json`¡£
  - Ôö¼Ó°æ±¾ĞÅÏ¢£ºÈÚºÏ²ÎÊı¡¢ãĞÖµ¡¢Ä£ĞÍ°æ±¾¡¢Êı¾İÀ´Ô´¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_risk_field_contract.py`
  - Ëæ»ú³é 10 ¸öÊ±¼äÆ¬¼ì²é shape¡¢dtype¡¢È¡Öµ·¶Î§Ò»ÖÂ¡£

### A2. ²»È·¶¨ĞÔĞ£×¼²úÏß»¯
- [ ] ÊµÏÖÄÚÈİ£º
  - ½«ÏÖÓĞ²»È·¶¨ĞÔĞ£×¼´ÓÀëÏß½Å±¾Éı¼¶Îª¿É¸´ÓÃÄ£¿é£¨ÑµÁ·ºó×Ô¶¯²ú³ö£©¡£
  - ¹Ì»¯Ğ£×¼²úÎï£º`outputs/calibration/{run_id}/calibration.json`¡£
  - Ìá¹©¼ÓÔØ½Ó¿Ú¹©ÍÆÀíÓë¹æ»®µ÷ÓÃ¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_uncertainty_calibration.py`
  - Êä³ö ECE/Brier Ç°ºó¶Ô±È±¨±í¡£

### A3. ¶àÔ´·çÏÕÈÚºÏÒıÇæ v1
- [ ] ÊµÏÖÄÚÈİ£º
  - ÈÚºÏÏî£º`U-Net caution/block`¡¢`uncertainty`¡¢`ice`¡¢`wave`¡¢`wind`¡¢`AIS deviation`¡£
  - Êä³öÖÁÉÙÈı²ã·çÏÕÍ¼£º`risk_conservative`¡¢`risk_balanced`¡¢`risk_aggressive`¡£
  - Ôö¼Ó fallback£ºÈÎÒ»µ¥Ô´È±Ê§Ê±×Ô¶¯½µ¼¶²¢¼ÇÂ¼Ô­Òò¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_risk_fusion.py`
  - ¹¹ÔìÈ±Ê§Ô´³¡¾°£¬ÑéÖ¤½µ¼¶Â·¾¶¿ÉÔËĞĞ¡£

### A4. ¹æ»®´ú¼Ûº¯ÊıÉı¼¶£¨CVaR / chance-constrained£©
- [ ] ÊµÏÖÄÚÈİ£º
  - ÔÚ¹æ»®Æ÷ÖĞ¼ÓÈë·çÏÕÏî£º`distance + lambda * risk`¡£
  - Ôö¼Ó `risk_mode`¡¢`risk_budget`¡¢`confidence_level` ²ÎÊı¡£
  - ĞÂÔöÁ½ÖÖ²ßÂÔ£º`cvar` Óë `chance_constrained`¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_planning_risk_modes.py`
  - ÔÚ¹Ì¶¨ÆğÖÕµãÉÏ¶Ô±È `astar/dstar/risk` µÄÂ·¾¶Óë´ú¼Û·Ö½â¡£

### A5. ¶àºòÑ¡²ßÂÔ²¢ĞĞ¹æ»®ÓëÅÅĞò
- [ ] ÊµÏÖÄÚÈİ£º
  - µ¥´ÎÇëÇó·µ»Ø 3 ÌõºòÑ¡º½Ïß£¨±£ÊØ/Æ½ºâ/¼¤½ø£©¡£
  - Ã¿ÌõºòÑ¡¸½´ø explain£º`distance`¡¢`risk_exposure`¡¢`caution_len`¡¢`blocked_margin`¡£
  - Ôö¼ÓºòÑ¡ÅÅĞòÂß¼­£¨Ä¬ÈÏ°´×ÛºÏ·ÖÊı£©¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_route_candidates.py`
  - API ·µ»ØºòÑ¡ÊıÓë explain ×Ö¶ÎÍêÕûĞÔĞ£Ñé¡£

### A6. ºó¶Ë API À©Õ¹Óë¼æÈİ²ã
- [ ] ÊµÏÖÄÚÈİ£º
  - À©Õ¹ `/v1/route/plan` Ö§³Ö·çÏÕ²ÎÊı£¬²»ÆÆ»µ¾ÉÇëÇó¡£
  - ĞÂÔö `/v1/risk/overlay` Óë `/v1/risk/summary`¡£
  - Ôö¼Ó schema °æ±¾ºÅÓë¼æÈİ´¦Àí¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_api_risk_extensions.py`
  - ¾ÉÇ°¶ËÇëÇó»Ø¹é²âÊÔÈ«²¿Í¨¹ı¡£

### A7. Ç°¶Ë·çÏÕ¹¤×÷Á÷Óë¿ÉÊÓ»¯
- [ ] ÊµÏÖÄÚÈİ£º
  - ÔÚµØÍ¼¹¤×÷Ì¨Ôö¼Ó·çÏÕ²ßÂÔÑ¡Ôñ£¨±£ÊØ/Æ½ºâ/¼¤½ø£©¡£
  - ĞÂÔö·çÏÕÍ¼²ãÓëÍ¸Ã÷¶È¿ØÖÆ¡¢Í¼Àı¡¢ãĞÖµ»¬¿é¡£
  - ºòÑ¡Â·ÏßÇĞ»»¿¨Æ¬£¨º¬¹Ø¼üÖ¸±ê¶Ô±È£©¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `cd frontend && npm run build`
  - ÊÖ¹¤ÑéÊÕ£º²ßÂÔÇĞ»»¡¢Í¼²ãÏÔÊ¾¡¢ºòÑ¡ÇĞ»»Áª¶¯Õı³£¡£

### A8. ¿É½âÊÍ±¨¸æÓëµ¼³öÄ£°åÉı¼¶
- [ ] ÊµÏÖÄÚÈİ£º
  - µ¼³ö±¨¸æÔö¼Ó·çÏÕ½âÊÍ¶Î£º¸ß·çÏÕÇø´©Ô½±ÈÀı¡¢¹æ±ÜÊÕÒæ¡¢Ô¤ËãÊ¹ÓÃÂÊ¡£
  - Gallery ¿¨Æ¬ĞÂÔö¡°·çÏÕ²ßÂÔ¡±ºÍ¡°·çÏÕÕªÒª¡±×Ö¶Î¡£
  - Ö§³Öµ¼³ö¶Ô±È±¨¸æ£¨Í¬ÆğÖÕµã¶à²ßÂÔ£©¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_closed_loop_report.py`
  - µ¼³ö JSON/Í¼Æ¬ÄÚº¬·çÏÕ×Ö¶ÎÇÒ¸ñÊ½ÎÈ¶¨¡£

### A9. »ù×¼ÆÀ²âÓë»Ø¹éÃÅ½û
- [ ] ÊµÏÖÄÚÈİ£º
  - ½¨Á¢¹Ì¶¨ benchmark ¼¯£¨µäĞÍÆğÖÕµãÓëÊ±¼äÆ¬£©¡£
  - ×Ô¶¯Êä³ö¶Ô±È£º`distance/risk/runtime/stability`¡£
  - Éè¶¨»Ø¹éãĞÖµ£ºĞÔÄÜÓë·çÏÕÖ¸±êÁÓ»¯Ê±×è¶ÏÌá½»¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python scripts/benchmark_planners.py`
  - Éú³É `outputs/benchmarks/risk_benchmark_*.json`¡£

### A10. Óë latest ÊµÊ±Á´Â·´òÍ¨£¨Éú²úÌ¬£©
- [ ] ÊµÏÖÄÚÈİ£º
  - latest À­È¡ºó×Ô¶¯´¥·¢£ºÍÆÀí -> ·çÏÕÈÚºÏ -> ¶à²ßÂÔ¹æ»®¡£
  - ½ø¶ÈÌõÏ¸»¯µ½·çÏÕ½×¶Î£¨calibrate/fuse/plan£©¡£
  - Copernicus ²»ÎÈ¶¨Ê±ÆôÓÃ×î½ü¿ÉÓÃ¿ìÕÕ»ØÍË²¢ÏÔÊ½ÌáÊ¾¡£
- [ ] ²âÊÔÑéÊÕ£¨ºóĞøÖ´ĞĞ£©£º
  - `python -m pytest -q tests/test_latest_resilience.py`
  - ¶Ëµ½¶ËÑİÊ¾£ºÖ¸¶¨ÈÕÆÚ³É¹¦²ú³öÈı²ßÂÔº½ÏßÓë·çÏÕÍ¼²ã¡£
